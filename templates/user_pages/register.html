<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register - Brands Out Loud</title>
    <script src="https://cdn.tailwindcss.com?plugins=typography,line-clamp"></script>
    <script src="https://unpkg.com/@phosphor-icons/web@2.0.3"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500&family=IBM+Plex+Sans:wght@600&family=Inter:wght@500&family=Plus+Jakarta+Sans:ital,wght@0,400;0,500;0,600;0,700;0,800;1,800&family=Roboto:wght@500&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="/static/icon/website_icon.png">
    <style>
        body {
            background-color: #030303;
            color: white;
        }
        .register-form-container {
            backdrop-filter: blur(20px);
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .input-field {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        .input-field:focus {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(99, 102, 241, 0.5);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        .register-button {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.8), rgba(168, 85, 247, 0.8));
            transition: all 0.3s ease;
        }
        .register-button:hover {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.9), rgba(168, 85, 247, 0.9));
            transform: translateY(-1px);
        }
        .error-message {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #fca5a5;
        }
        .success-message {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            color: #86efac;
        }
        .loading-spinner {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .hamburger-line { transition: all 0.3s ease; }
        .hamburger-active .hamburger-line:nth-child(1) { transform: translateY(7px) rotate(45deg); }
        .hamburger-active .hamburger-line:nth-child(2) { opacity: 0; }
        .hamburger-active .hamburger-line:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }
        .search-input { transition: all 0.2s ease; }
        .search-input:focus { box-shadow: 0 0 0 2px rgba(151, 71, 255, 0.5); }
        @keyframes slideDown {
            from { transform: translateY(-10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .slide-down {
            animation: slideDown 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }
         @media screen and (min-width: 1024px) {
        body {
            zoom:1.12;
        }
    }
    .gradient-text {
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        text-fill-color: transparent;
        display: inline-block; 
    }
    .strip-startups { background-image: linear-gradient(93.43deg, #000000 6.93%, #3533CD 94.41%); }
    .strip-ai { background-image: linear-gradient(211.98deg, #000000 19.22%, #3533CD 94.53%); }
    .strip-business { background-image: linear-gradient(105.57deg, #000000 2.6%, #3533CD 60.9%); }
    .strip-entrepreneur { background-image: linear-gradient(90.82deg, #000000 3.28%, #3533CD 140.89%); }
    .strip-events { background-image: linear-gradient(260.78deg, #000000 43.02%, #3533CD 106.67%); }
    .strip-brands { background-image: linear-gradient(104.28deg, #000000 3.4%, #3533CD 101.3%); }
    .strip-trends { background-image: linear-gradient(264.46deg, #000000 -20.15%, #3533CD 54.42%); }
    .podcast-title-gradient { background: linear-gradient(269.15deg, #000000 47.22%, #3533CD 97.69%); }
    .hero-title-gradient { background: linear-gradient(90deg, #FFFFFF 0%, #3533CD 100%); }
    .footer-italic-gradient { background: linear-gradient(90deg, #C4C3FF 0%, #10E2FF 100%); }
    .button-icon-plus-shape::before,
    .button-icon-plus-shape::after {
        content: '';
        position: absolute;
        background-color: currentColor; 
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
    }
    .button-icon-plus-shape::before { width: 12px; height: 2px; }
    .button-icon-plus-shape::after { width: 2px; height: 12px; }
    .button-icon-union-shape {
         background: currentColor; 
    }
     .location-input-wrapper::after {
        content: '';
        position: absolute;
        width: 0; height: 0;
        border-left: 5px solid transparent;
        border-right: 5px solid transparent;
        border-top: 6px solid #414141; 
        right: 15px; 
        top: 50%;
        transform: translateY(-50%);
        pointer-events: none; 
    }
    input[type="checkbox"]:checked {
        background-color: #3533CD;
        border-color: #3533CD;
        background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z'/%3e%3c/svg%3e");
        background-size: 100% 100%;
        background-position: center;
        background-repeat: no-repeat;
    }
    ::-webkit-scrollbar {
        display: none;
    }
    body {
        -ms-overflow-style: none;  
        scrollbar-width: none;  
    }
    @keyframes slideDown {
        from { transform: translateY(-10px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }
    
    .slide-down {
        animation: slideDown 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    }
    :root {
        --clr-dark-black: #121212;
        --clr-bdr-gray: #2a2a2a;
        --clr-white: #fff;
        --clr-primary: #9747FF;
        --clr-primary-light: #CDA7FF;
        --clr-gray-800: #1e1e1e;
    }
    .mobile-menu-item {
        padding: 0.875rem 1rem;
        background: var(--clr-dark-black);
        border-bottom: solid 1px var(--clr-bdr-gray);
        color: var(--clr-white);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: space-between;
        transition: background-color 0.2s ease;
    }
    
    .mobile-menu-item:hover { background-color: #1a1a1a; }
    .mobile-menu-item:active { background-color: #252525; }
    .item-title { flex-grow: 1; margin-left: 0.75rem; font-weight: 500; }
    .hamburger-line { transition: all 0.3s ease; }
    .hamburger-active .hamburger-line:nth-child(1) { transform: translateY(7px) rotate(45deg); }
    .hamburger-active .hamburger-line:nth-child(2) { opacity: 0; }
    .hamburger-active .hamburger-line:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }
    .search-input { transition: all 0.2s ease; }
    .search-input:focus { box-shadow: 0 0 0 2px rgba(151, 71, 255, 0.5); }
    @keyframes shine {
        from { transform: translateX(-100%); }
        to { transform: translateX(100%); }
    }
    .login-btn { transition: all 0.2s ease; }
    .login-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 2px 8px rgba(205, 167, 255, 0.4);
    }
    /* --- UPDATED DROPDOWN STYLES --- */
    .dropdown-container {
        position: relative;
        padding-bottom: 20px; /* Creates an invisible area below the link for the cursor to travel over */
        margin-bottom: -20px;  /* Negative margin to pull layout back up */
    }
    .dropdown-content {
        position: absolute;
        top: 100%; /* Positions the dropdown right below the parent's padding area */
        left: 50%;
        transform: translateX(-50%);
        width: 320px;
        background: white;
        border-radius: 8px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        border: 1px solid #e5e7eb;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.2s ease, visibility 0.2s;
        z-index: 50;
        pointer-events: none;
        padding: 1rem;
    }
    .dropdown-container:hover .dropdown-content {
        opacity: 1;
        visibility: visible;
        pointer-events: auto;
    }
    
    .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
    .dropdown-item {
        transition: all 0.2s ease;
    }
    .dropdown-item:hover {
        background-color: #f9fafb;
        transform: translateX(2px);
    }
    .dropdown-item:hover .ph-arrow-right {
        transform: translateX(2px);
        color: #3533CD;
    }
    /* --- MOBILE ACCORDION STYLES --- */
    .accordion-toggle .item-title {
        flex-grow: 1;
    }
    .accordion-icon {
        transition: transform 0.3s ease, color 0.3s ease;
    }
    .accordion-toggle[aria-expanded="true"] .accordion-icon {
        transform: rotate(180deg);
        color: white;
    }
    .accordion-content {
        background-color: #1a1a1a;
        overflow: hidden;
        max-height: 0;
        transition: max-height 0.4s cubic-bezier(0.25, 1, 0.5, 1);
    }
    .sub-menu-item {
        display: flex;
        align-items: center;
        padding: 0.5rem;
        border-radius: 0.375rem;
        transition: background-color 0.2s ease;
        color: white;
        text-decoration: none;
    }
    .sub-menu-item:hover {
        background-color: #252525;
    }
    </style>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              'jakarta': ['"Plus Jakarta Sans"', 'sans-serif'],
              'helvetica': ['"Helvetica Now Display"', 'Arial', 'sans-serif'], 
              'dm': ['"DM Sans"', 'sans-serif'],
              'ibm-plex': ['"IBM Plex Sans"', 'sans-serif'],
              'inter': ['"Inter"', 'sans-serif'],
              'roboto': ['"Roboto"', 'sans-serif'],
              'sans': ['"Plus Jakarta Sans"', 'sans-serif'], 
            },
            colors: {
              'bol-purple': '#3533CD',
              'bol-purple-light': '#C4C3FF',
              'bol-black': '#0D0D0D',
              'bol-gray': '#B8C2CE',
            },
            spacing: { 
              '1.5px': '1.5px',
              '13px': '13px',
            },
            fontSize: { 
               '10px': '10px',
            },
             lineHeight: { 
               '13px': '13px',
            },
            animation: {
              marquee: 'marquee 30s linear infinite',
            },
            keyframes: {
              marquee: {
                '0%': { transform: 'translateX(0%)' },
                '100%': { transform: 'translateX(-50%)' }, 
              }
            }
          }
        }
      }
    </script>
    <script>
            document.addEventListener('DOMContentLoaded', function() {
                const mobileMenuButton = document.getElementById('mobile-menu-button');
                const mobileMenu = document.getElementById('mobile-menu');
                
                if (mobileMenuButton && mobileMenu) {
                    mobileMenuButton.addEventListener('click', function() {
                        mobileMenu.classList.toggle('hidden');
                        mobileMenuButton.classList.toggle('hamburger-active');
                        
                        if (!mobileMenu.classList.contains('hidden')) {
                            mobileMenu.classList.add('slide-down');
                        } else {
                            mobileMenu.classList.remove('slide-down');
                        }
                    });
                }
                document.addEventListener('click', function(e) {
                    if (e.target.closest('.dropdown-item:not(.know-more-item)')) {
                        const item = e.target.closest('.dropdown-item');
                        const category = item.getAttribute('data-category');
                        const blogId = item.getAttribute('data-id');
                        
                        console.log('Clicked blog:', { category, blogId });
                    }
                });
                document.addEventListener('click', function(e) {
                    if (e.target.closest('.know-more-item')) {
                        const item = e.target.closest('.dropdown-container');
                        const category = item.getAttribute('data-category');
                        
                        console.log('Know More clicked for:', category);
                    }
                });
                const mobileMenuContainer = document.getElementById('mobile-menu');
                if (mobileMenuContainer) {
                    mobileMenuContainer.addEventListener('click', function(e) {
                        const toggle = e.target.closest('.accordion-toggle');
                        if (!toggle) return;
                        e.preventDefault();
                        const content = toggle.nextElementSibling;
                        const isCurrentlyOpen = toggle.getAttribute('aria-expanded') === 'true';
                        mobileMenuContainer.querySelectorAll('.accordion-toggle').forEach(otherToggle => {
                            if (otherToggle !== toggle) {
                                otherToggle.setAttribute('aria-expanded', 'false');
                                const otherContent = otherToggle.nextElementSibling;
                                if (otherContent) otherContent.style.maxHeight = '0px';
                            }
                        });
                        if (isCurrentlyOpen) {
                            toggle.setAttribute('aria-expanded', 'false');
                            content.style.maxHeight = '0px';
                        } else {
                            toggle.setAttribute('aria-expanded', 'true');
                            content.style.maxHeight = content.scrollHeight + 'px';
                        }
                    });
                }
            });
        </script>
</head>
<body class="font-jakarta">
    {{ header | safe }}
    <div class="flex flex-col items-center w-full max-w-[1440px] mx-auto bg-white overflow-x-hidden relative">
        

        <div class="w-full min-h-screen flex items-center justify-center bg-[#030303] py-12">
            <div class="relative z-10 w-full max-w-md mx-4">
                <div class="register-form-container rounded-2xl p-8 shadow-2xl">
                    <div class="text-center mb-8">
                        <h1 class="text-3xl font-bold mb-2 bg-clip-text text-transparent bg-gradient-to-r from-white to-white/80">
                            Create Account
                        </h1>
                        <p class="text-white/60 text-sm">Join Brands Out Loud</p>
                    </div>
                    
                    <form id="register-form" class="space-y-6">
                        <div>
                            <label for="username" class="block text-sm font-medium text-white/80 mb-2">Username</label>
                            <input
                                type="text"
                                id="username"
                                name="username"
                                required
                                class="input-field w-full px-4 py-3 rounded-lg text-white placeholder-white/40 focus:outline-none"
                                placeholder="Enter your username"
                            >
                        </div>

                        <div>
                            <label for="email" class="block text-sm font-medium text-white/80 mb-2">Email</label>
                            <input 
                                type="email" 
                                id="email" 
                                name="email" 
                                required 
                                class="input-field w-full px-4 py-3 rounded-lg text-white placeholder-white/40 focus:outline-none"
                                placeholder="Enter your email"
                            >
                        </div>
                        
                        <div>
                            <label for="password" class="block text-sm font-medium text-white/80 mb-2">Password</label>
                            <input 
                                type="password" 
                                id="password" 
                                name="password" 
                                required 
                                class="input-field w-full px-4 py-3 rounded-lg text-white placeholder-white/40 focus:outline-none"
                                placeholder="Create a password"
                            >
                        </div>

                        <div id="error-message" class="error-message rounded-lg p-3 text-sm hidden"></div>
                        <div id="success-message" class="success-message rounded-lg p-3 text-sm hidden"></div>
                        
                        <button 
                            type="submit" 
                            id="register-btn"
                            class="register-button w-full py-3 rounded-lg font-medium text-white focus:outline-none focus:ring-2 focus:ring-indigo-500/50"
                        >
                            <span id="register-btn-text">Register</span>
                            <div id="register-btn-spinner" class="loading-spinner w-5 h-5 border-2 border-white/30 border-t-white rounded-full mx-auto hidden"></div>
                        </button>

                        <p class="text-center text-sm text-white/60">
                            Already have an account? <a href="/login" class="font-medium text-indigo-400 hover:text-indigo-300">Login here</a>
                        </p>
                    </form>
                </div>
            </div>
        </div>

        
    </div>
    {{ footer | safe }}

    <script>
        document.getElementById('register-form').addEventListener('submit', async function(e) {
            e.preventDefault();

            const username = document.getElementById('username').value;
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const errorElement = document.getElementById('error-message');
            const successElement = document.getElementById('success-message');
            const registerBtn = document.getElementById('register-btn');
            const registerBtnText = document.getElementById('register-btn-text');
            const registerBtnSpinner = document.getElementById('register-btn-spinner');

            // Show loading state
            registerBtnText.classList.add('hidden');
            registerBtnSpinner.classList.remove('hidden');
            registerBtn.disabled = true;
            errorElement.classList.add('hidden');
            successElement.classList.add('hidden');

            try {
                const response = await fetch('/user_register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, email, password })
                });

                const data = await response.json();

                if (response.ok && data.user) {
                    // Handle successful registration
                    successElement.textContent = 'Registration successful! Logging you in...';
                    successElement.classList.remove('hidden');
                    
                    // Cache user data
                    localStorage.setItem('user', JSON.stringify(data.user));
                    
                    setTimeout(() => {
                        window.location.href = '/'; // Redirect to homepage
                    }, 1500);
                } else {
                    // Handle error
                    errorElement.textContent = data.message || 'An unknown error occurred.';
                    errorElement.classList.remove('hidden');
                }
            } catch (error) {
                console.error('Registration error:', error);
                errorElement.textContent = 'A network error occurred. Please try again.';
                errorElement.classList.remove('hidden');
            } finally {
                // Reset button state
                registerBtnText.classList.remove('hidden');
                registerBtnSpinner.classList.add('hidden');
                registerBtn.disabled = false;
            }
        });
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const user = JSON.parse(localStorage.getItem('user'));
            if (user && user.username) {
                updateHeader(user.username);
            }
        });

        function updateHeader(username) {
            const desktopAuthSection = document.getElementById('user-auth-section');
            const mobileAuthSection = document.getElementById('mobile-user-auth-section');

            const loggedInHTML = `
                <span class="text-white font-bold text-[10px] text-center flex-shrink-0">Welcome, ${username}</span>
                <a href="#" id="logout-btn" class="bg-[#CDA7FF] rounded-[2px] px-2.5 py-0.5 text-[#0D0D0D] font-bold text-[10px] text-center flex-shrink-0">Logout</a>
            `;

            const mobileLoggedInHTML = `
                <div class="text-white text-center py-2">Welcome, ${username}</div>
                <a href="#" id="mobile-logout-btn" class="login-btn block w-full text-center bg-red-500 rounded-full px-4 py-2.5 text-white font-medium text-sm">
                    <span class="relative z-10 flex items-center justify-center gap-2"><span>Logout</span></span>
                </a>
            `;

            if(desktopAuthSection) desktopAuthSection.innerHTML = loggedInHTML;
            if(mobileAuthSection) mobileAuthSection.innerHTML = mobileLoggedInHTML;

            const logoutBtn = document.getElementById('logout-btn');
            if(logoutBtn) logoutBtn.addEventListener('click', logout);
            
            const mobileLogoutBtn = document.getElementById('mobile-logout-btn');
            if(mobileLogoutBtn) mobileLogoutBtn.addEventListener('click', logout);
        }

        function logout(e) {
            e.preventDefault();
            localStorage.removeItem('user');
            window.location.reload();
        }
    </script>
</body>
</html>