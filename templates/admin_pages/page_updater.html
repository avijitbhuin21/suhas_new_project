<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Page Updater Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            background-color: #030303;
            color: white;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }
        .tab-button {
            transition: all 0.6s cubic-bezier(0.25, 0.4, 0.25, 1);
        }
        .tab-text {
            transition: all 0.8s cubic-bezier(0.25, 0.4, 0.25, 1);
            max-width: 0;
            opacity: 0;
            overflow: hidden;
            white-space: nowrap;
        }
        .tab-text.expanded {
            max-width: 200px;
            opacity: 1;
            margin-left: 0.5rem;
        }
        .tab-button.selected {
            padding-left: 1rem;
            padding-right: 1rem;
        }
        .tab-button:not(.selected) {
            padding-left: 0.75rem;
            padding-right: 0.75rem;
        }
        .separator {
            width: 1px;
            height: 20px;
            margin: 0 0.5rem;
        }
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to   { opacity: 1; transform: translateY(0); }
        }
        .anim-hidden-initial {
            opacity: 0;
        }
        .content-section {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }
        .content-section.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .form-container {
            max-width: none;
            margin: 0;
            padding: 1rem;
        }
        .form-item {
            margin-bottom: 1rem;
        }
        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: white;
            font-family: 'Inter', sans-serif;
            letter-spacing: 0.025em;
        }
        .form-input {
            width: 100%;
            height: 2.25rem;
            padding: 0.5rem 0.75rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 0.5rem;
            background-color: rgba(255, 255, 255, 0.05);
            color: white;
            font-size: 0.875rem;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }
        .form-input:focus {
            outline: none;
            border-color: rgb(59, 130, 246);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        .form-input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }
        .form-button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.5rem;
            background-color: rgb(59, 130, 246);
            color: white;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            font-family: 'Inter', sans-serif;
            letter-spacing: 0.025em;
        }
        .form-button:hover {
            background-color: rgb(37, 99, 235);
        }
        .section-title {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: white;
            letter-spacing: -0.025em;
        }
        .section-content {
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.6;
        }
        .form-row {
            display: flex;
            gap: 1rem;
        }
        .form-row .form-item {
            flex: 1;
        }
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
                gap: 0;
            }
        }
        
        /* Calendar icon for date input */
        input[type="date"] {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>');
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 1rem;
        }
        
        /* Remove button styling and animation */
        .remove-section {
            transition: all 0.3s ease;
            color: white !important;
        }
        .remove-section:hover {
            color: white !important;
            transform: rotate(90deg);
        }
        
        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: transparent;
            backdrop-filter: blur(5px);
        }
        
        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease-out;
        }
        
        .modal-content {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.3s ease-out;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .modal-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            font-weight: 600;
            color: white;
            margin: 0;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.6);
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.5rem;
            transition: all 0.2s ease;
        }
        
        .modal-close:hover {
            color: white;
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .modal-body {
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.6;
            margin-bottom: 1.5rem;
        }
        
        .modal-url-link {
            color: #60a5fa;
            text-decoration: underline;
            word-break: break-all;
            word-wrap: break-word;
            overflow-wrap: break-word;
            hyphens: auto;
            transition: color 0.2s ease;
        }
        
        .modal-url-link:hover {
            color: #93c5fd;
            text-decoration: none;
        }
        
        .modal-body p {
            word-break: break-word;
            overflow-wrap: break-word;
        }
        
        .modal-button {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: 'Inter', sans-serif;
        }
        
        .modal-button-primary {
            background-color: rgb(59, 130, 246);
            color: white;
        }
        
        .modal-button-primary:hover {
            background-color: rgb(37, 99, 235);
        }
        
        .modal-button-secondary {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .modal-button-secondary:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .error-modal .modal-title {
            color: #ef4444;
        }
        
        .success-modal .modal-title {
            color: #10b981;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        /* Line clamp utility for text truncation */
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        /* Page list item hover effects */
        .page-item {
            transition: all 0.2s ease-in-out;
        }
        
        .page-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        /* Pagination button styles */
        .pagination-btn {
            transition: all 0.2s ease-in-out;
        }
        
        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .pagination-btn:not(:disabled):hover {
            transform: translateY(-1px);
        }
        
        /* Search input focus enhancement */
        .search-input:focus {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            border-color: rgb(59, 130, 246);
        }
        
        /* Status badge styles */
        .status-badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            font-weight: 500;
        }
        
        .status-published {
            background-color: rgba(34, 197, 94, 0.2);
            color: rgb(74, 222, 128);
        }
        
        .status-draft {
            background-color: rgba(234, 179, 8, 0.2);
            color: rgb(250, 204, 21);
        }
        
        /* Grid Layout Styles */
        .main-grid-container {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(5, 1fr);
            gap: 16px;
            min-height: calc(100vh - 120px);
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .left-section {
            grid-column: span 3 / span 3;
            grid-row: span 5 / span 5;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1.5rem;
            overflow-y: auto;
            overflow-x: hidden;
            max-height: calc(100vh - 140px);
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        
        .left-section::-webkit-scrollbar {
            display: none;
        }
        
        .right-section {
            grid-column: span 2 / span 2;
            grid-row: span 5 / span 5;
            grid-column-start: 4;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1.5rem;
            overflow-y: auto;
            overflow-x: hidden;
            max-height: calc(100vh - 140px);
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        
        .right-section::-webkit-scrollbar {
            display: none;
        }
        
        .left-section-header {
            backdrop-filter: blur(35px);
            -webkit-backdrop-filter: blur(35px);
            border-radius: 70px;
            padding: 12px 20px;
            margin-bottom: 2rem;
        }
        
        .left-section-tabs {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .left-tab-button {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1.25rem 2rem;
            border-radius: 12px;
            color: rgba(255, 255, 255, 0.5);
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
        }
        
        .left-tab-button:hover {
            background: rgba(255, 255, 255, 0.05);
            color: rgba(255, 255, 255, 0.9);
            transform: translateY(-2px);
        }
        
        .left-tab-button.active {
            color: rgba(255, 255, 255, 0.9);;
        }
        
        .left-content-section {
            display: none;
            margin-top: 1.5rem;
        }
        
        .left-content-section.active {
            display: block;
        }
        
        /* Responsive adjustments */
        @media (max-width: 1200px) {
            .main-grid-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto;
                gap: 1rem;
            }
            
            .left-section {
                grid-column: 1;
                grid-row: 1;
            }
            
            .right-section {
                grid-column: 1;
                grid-row: 2;
                grid-column-start: auto;
            }
            
            .left-section-tabs {
                flex-direction: row;
                flex-wrap: wrap;
            }
        }
        
        @media (max-width: 768px) {
            .main-grid-container {
                padding: 0 1rem;
            }
            
            .left-section, .right-section {
                padding: 1rem;
            }
        }
        
        /* Upload and Gallery Styles from manage_files.html */
        .dropzone {
            border: 2px dashed rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 2.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            background-color: rgba(255, 255, 255, 0.02);
        }
        .dropzone.dragover {
            border-color: rgb(59, 130, 246);
            background-color: rgba(59, 130, 246, 0.1);
        }
        .dropzone i,
        .dropzone p {
            transition: opacity 0.2s ease-in-out;
        }
        .file-queue-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            border-radius: 20px;
            background-color: rgba(255, 255, 255, 0.05);
        }
        .gallery-item {
            position: relative;
            overflow: hidden;
            border-radius: 20px;
            transition: all 0.2s ease;
            background-color: rgba(255, 255, 255, 0.03);
        }
        .gallery-item:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }
        .gallery-item .overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent 50%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .gallery-item:hover .overlay {
            opacity: 1;
        }
        .gallery-item .actions {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            display: flex;
            gap: 0.5rem;
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            z-index: 10;
            pointer-events: auto;
        }
        .gallery-item:hover .actions {
            opacity: 1;
            transform: translateY(0);
        }
        .gallery-item .actions button {
            border-radius: 9999px;
            padding: 0.5rem;
            background-color: rgba(0,0,0,0.5);
            transition: background-color 0.2s;
        }
        .gallery-item .actions button:hover {
             background-color: black;
        }
        .search-input-container {
            position: relative;
        }
        .search-input-container::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 1px;
            background-color: rgba(255, 255, 255, 0.6);
            transform: translateX(-50%);
            transition: width 0.3s ease-in-out;
        }
        .search-input-container:hover::after {
            width: 100%;
        }
        .search-input-container.focused::after {
            width: 100%;
        }
        .search-input {
            background-color: transparent;
            border: none;
            color: white;
            transition: all 0.3s ease-in-out;
        }
        .search-input:focus {
            outline: none;
        }
        .search-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        
        /* Storage sub-tabs styles */
        .storage-sub-tab {
            transition: all 0.2s ease;
        }
        
        .storage-sub-tab:hover {
            background: rgba(255, 255, 255, 0.15) !important;
            color: rgba(255, 255, 255, 0.9) !important;
        }
        
        .storage-sub-tab.active {
            background: rgba(59, 130, 246, 0.2) !important;
            color: white !important;
            border-color: rgba(59, 130, 246, 0.4) !important;
        }
        
        .storage-sub-content {
            display: none;
        }
        
        .storage-sub-content.active {
            display: block;
        }
        
        /* Text formatting toolbar styles */
        .text-formatting-toolbar {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.5rem;
            padding: 0.5rem;
        }
        
        .format-btn {
            padding: 0.5rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 0.375rem;
            background-color: rgba(255, 255, 255, 0.05);
            color: white;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .format-btn:hover {
            background-color: rgba(255, 255, 255, 0.15);
            border-color: rgb(59, 130, 246);
        }
        
        .format-btn.active {
            background-color: rgb(59, 130, 246);
            border-color: rgb(59, 130, 246);
        }
    </style>
</head>
<body>
    <nav class="fixed top-0 left-0 right-0 z-50">
        <div class="flex justify-center py-6">
            <div class="navbar-wrapper" style="backdrop-filter: blur(35px); -webkit-backdrop-filter: blur(35px); background: rgba(255, 255, 255, 0.02); border: 1px solid rgba(255, 255, 255, 0.05); border-radius: 70px; padding: 12px 20px;">
                <div id="navbarTabs" class="expandable-tabs flex items-center gap-4 anim-hidden-initial" style="animation: slideDown 0.8s cubic-bezier(0.25, 0.4, 0.25, 1) 0.3s forwards;">
                </div>
            </div>
        </div>
    </nav>
    <div class="fixed inset-0 bg-gradient-to-br from-indigo-500/[0.03] via-transparent to-rose-500/[0.03] pointer-events-none"></div>
    
    <!-- Main Content Sections -->
    <main class="pt-20 px-4">
        <div class="main-grid-container">
            <!-- Left Section (Gallery) -->
            <div class="left-section">
                <!-- Left Section Header -->
                <div class="left-section-header">
                    <div class="expandable-tabs flex items-center gap-2">
                        <button class="left-tab-button active" data-left-tab="upload-image">
                            <div class="flex-shrink-0">
                                <i data-lucide="image" class="w-4 h-4"></i>
                            </div>
                            <span>Upload Image</span>
                        </button>
                        <button class="left-tab-button" data-left-tab="storage">
                            <div class="flex-shrink-0">
                                <i data-lucide="image" class="w-4 h-4"></i>
                            </div>
                            <span>Gallery</span>
                        </button>
                    </div>
                </div>

                <!-- Left Section Content -->
                <div id="upload-imageContent" class="left-content-section active">
                    <h3 class="text-lg font-semibold mb-4 text-white" style="font-family: 'Playfair Display', serif;">Upload Images</h3>
                    <div class="bg-black/20 border-white/10 rounded-[20px] p-6">
                        <!-- Dropzone -->
                        <div id="imageDropzone" class="dropzone flex flex-col items-center justify-center space-y-3" style="border: 2px dashed rgba(255, 255, 255, 0.2); border-radius: 20px; padding: 2.5rem; text-align: center; cursor: pointer; transition: all 0.2s ease; background-color: rgba(255, 255, 255, 0.02);">
                            <i id="imageDropzoneIcon" data-lucide="upload-cloud" class="w-12 h-12 text-white/40"></i>
                            <p class="font-semibold">Drag & drop images here</p>
                            <p id="imageDropzoneText" class="text-sm text-white/60">Upload JPG, PNG, WEBP, etc. Max 10MB.</p>
                            <p class="text-xs text-white/50">or</p>
                            <button type="button" onclick="document.getElementById('imageFileInput').click()" class="form-button bg-white/10 hover:bg-white/20 text-white/90 !px-4 !py-2">Browse Files</button>
                        </div>
                        <input type="file" id="imageFileInput" multiple accept="image/*" class="hidden">
                        
                        <!-- File Queue -->
                        <div id="imageFileQueue" class="mt-6 space-y-3"></div>
                        
                        <!-- Upload Button -->
                        <div class="mt-8 flex justify-center">
                            <button id="imageUploadBtn" class="form-button bg-white text-black hover:bg-gray-100" disabled>
                                <i data-lucide="upload" class="w-4 h-4 mr-2"></i>
                                <span id="imageUploadBtnText">Upload 0 Files</span>
                            </button>
                        </div>
                    </div>
                </div>

                <div id="storageContent" class="left-content-section">
                    <!-- Gallery Sub-section -->
                    <div id="gallerySubContent" class="storage-sub-content active">
                        <!-- Search Bar -->
                        <div class="relative mb-6">
                            <div class="search-input-container" style="position: relative;">
                                <i data-lucide="search" class="w-4 h-4 absolute left-4 top-1/2 -translate-y-1/2 text-white/40 z-10"></i>
                                <input type="text" placeholder="Search images..." class="search-input w-full py-2 pl-11 pr-4 text-sm rounded-[20px] focus:ring-0 focus:outline-none transition bg-transparent border-none color-white" id="gallerySearchInput" style="background-color: transparent; border: none; color: white;">
                            </div>
                        </div>
                        
                        <!-- Gallery Grid -->
                        <div id="galleryGrid" class="grid grid-cols-4 gap-4">
                            <!-- Dynamic gallery items will be inserted here -->
                        </div>
                        
                        <div id="noGalleryItems" class="text-center py-8 hidden">
                            <i data-lucide="folder-x" class="w-12 h-12 mx-auto text-white/20 mb-4"></i>
                            <h4 class="text-lg font-medium text-white/80">No Images Found</h4>
                            <p class="text-white/50 mt-2">Try uploading some images or changing your search.</p>
                        </div>
                    </div>

                    <!-- Magazines Sub-section (Placeholder, can remove if not needed) -->
                    <div id="magazinesSubContent" class="storage-sub-content">
                        <div class="relative mb-6">
                            <div class="search-input-container" style="position: relative;">
                                <i data-lucide="search" class="w-4 h-4 absolute left-4 top-1/2 -translate-y-1/2 text-white/40 z-10"></i>
                                <input type="text" placeholder="Search magazines..." class="search-input w-full py-2 pl-11 pr-4 text-sm rounded-[20px] focus:ring-0 focus:outline-none transition bg-transparent border-none color-white" id="magazinesSearchInput" style="background-color: transparent; border: none; color: white;">
                            </div>
                        </div>
                        
                        <div id="magazinesGrid" class="grid grid-cols-4 gap-4">
                            <!-- Dynamic magazine items will be inserted here -->
                        </div>
                        
                        <div id="noMagazineItems" class="text-center py-8 hidden">
                            <i data-lucide="folder-x" class="w-12 h-12 mx-auto text-white/20 mb-4"></i>
                            <h4 class="text-lg font-medium text-white/80">No Magazines Found</h4>
                            <p class="text-white/50 mt-2">Try uploading some magazines or changing your search.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Section (Page List and Editor) -->
            <div class="right-section">
                <!-- Page List Section -->
                <section id="pageListSection" class="content-section active">
                    <div class="form-container">
                        <h2 class="section-title text-center">Manage Pages</h2>
                        <div class="section-content">
                            <!-- Filters -->
                            <div class="form-row mb-4">
                                <div class="form-item">
                                    <label class="form-label" for="filterPageName"><i data-lucide="type" class="w-4 h-4 inline mr-2"></i>Filter by Page Name</label>
                                    <input type="text" id="filterPageName" class="form-input" placeholder="Enter page name...">
                                </div>
                            </div>

                            <!-- Loading State -->
                            <div id="pagesLoading" class="text-center py-8 hidden">
                                <i data-lucide="loader-2" class="w-6 h-6 animate-spin mx-auto mb-2 text-white/60"></i>
                                <p class="text-white/60">Loading pages...</p>
                            </div>

                            <!-- No Results State -->
                            <div id="noPagesFound" class="text-center py-8 hidden">
                                <i data-lucide="file-x" class="w-12 h-12 mx-auto mb-4 text-white/40"></i>
                                <h3 class="text-lg font-semibold mb-2 text-white/80">No pages found</h3>
                                <p class="text-white/60">Try adjusting your search terms or check back later.</p>
                            </div>

                            <!-- Pages List Container -->
                            <div id="pagesList" class="space-y-4">
                                <!-- Dynamic page entries will be inserted here -->
                            </div>

                            <!-- Pagination Controls -->
                            <div id="paginationControls" class="flex justify-center items-center gap-4 mt-6 hidden">
                                <button id="prevPage" class="form-button bg-white/10 hover:bg-white/20 border border-white/20 text-white text-xs px-3 py-2 disabled:opacity-50 disabled:cursor-not-allowed">
                                    <div class="flex items-center gap-2">
                                        <i data-lucide="chevron-left" class="w-3 h-3"></i>
                                        <p>Previous</p>
                                    </div>
                                </button>
                                <span id="pageInfo" class="text-sm text-white/60 px-4">
                                    Page 1 of 1
                                </span>
                                <button id="nextPage" class="form-button bg-white/10 hover:bg-white/20 border border-white/20 text-white text-xs px-3 py-2 disabled:opacity-50 disabled:cursor-not-allowed">
                                    <div class="flex items-center gap-2">
                                        <p>Next</p>
                                        <i data-lucide="chevron-right" class="w-3 h-3"></i>
                                    </div>
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Page Editor Section (Hidden by default, shown when "Edit" is clicked) -->
                <section id="pageEditorSection" class="content-section">
                    <div class="form-container">
                        <h2 class="section-title text-center">Edit Page: <span id="editingPageName"></span></h2>
                        <form id="pageEditorForm">
                            <input type="hidden" id="pageId" name="pageId">
                            <input type="hidden" id="pageUpdatedAt" name="pageUpdatedAt">

                            <!-- Page Name -->
                            <div class="form-item">
                                <label class="form-label" for="pageName"><i data-lucide="file-text" class="w-4 h-4 inline mr-2"></i>Page Name</label>
                                <input type="text" id="pageName" name="pageName" class="form-input" required readonly>
                            </div>

                            <!-- Dynamic JSON Editor -->
                            <div class="content-section-wrapper p-4 rounded-lg bg-transparent border-transparent mb-6">
                                <h3 class="text-lg font-medium text-white/90 mb-4 flex items-center">
                                    <i data-lucide="code" class="w-5 h-5 mr-2"></i>Page Data (JSON)
                                </h3>
                                <div id="jsonEditor" class="space-y-4">
                                    <!-- Dynamic fields will be generated here based on page_data -->
                                </div>
                            </div>

                            <!-- Action Buttons -->
                            <div class="flex justify-end gap-3">
                                <button type="button" id="cancelEditBtn" class="form-button bg-gray-600 hover:bg-gray-700 text-white">
                                    <i data-lucide="x" class="w-4 h-4 mr-2"></i>
                                    Cancel
                                </button>
                                <button type="button" id="previewPageBtn" class="form-button bg-blue-500 hover:bg-blue-600 text-white">
                                    <div class="flex items-center gap-2">
                                        <i data-lucide="eye" class="w-4 h-4"></i>
                                        <p>Preview Page</p>
                                    </div>
                                </button>
                                <button type="button" id="updatePageBtn" class="form-button bg-white/10 hover:bg-white/20 border border-white/20 text-white">
                                    <div class="flex items-center gap-2">
                                        <i data-lucide="save" class="w-4 h-4"></i>
                                        <p>Update Page</p>
                                    </div>
                                </button>
                            </div>
                        </form>
                    </div>
                </section>
            </div>
        </div>
    </main>
    
    <!-- Modal for displaying messages -->
    <div id="messageModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle" class="modal-title">Message</h3>
                <button type="button" class="modal-close" onclick="closeModal()">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            <div class="modal-body">
                <p id="modalMessage">Message content goes here.</p>
            </div>
        </div>
    </div>
    
    <!-- Delete Confirmation Dialog Modal -->
    <div id="deleteConfirmModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Confirm Page Deletion</h3>
                <button type="button" class="modal-close" onclick="closeDeleteConfirmModal()">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="space-y-4">
                    <div class="p-4 bg-red-600/10 border border-red-600/20 rounded-lg">
                        <div class="flex items-start gap-3">
                            <i data-lucide="alert-triangle" class="w-5 h-5 text-red-400 mt-0.5 flex-shrink-0"></i>
                            <div>
                                <h4 class="text-red-400 font-medium mb-1">Warning: This action will permanently delete the page</h4>
                                <p class="text-white/80 text-sm">You are about to delete the following page:</p>
                                <p id="deletePageName" class="text-white font-medium mt-2 break-words"></p>
                                <p class="text-white/60 text-xs mt-2">Note: This action cannot be undone.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-item">
                        <label class="flex items-start gap-2 cursor-pointer">
                            <input type="checkbox" id="confirmDeleteCheckbox" class="mt-1 w-4 h-4 text-red-600 bg-gray-100 border-gray-300 rounded focus:ring-red-500">
                            <span class="text-sm text-white/80">
                                I understand that this page will be permanently deleted.
                            </span>
                        </label>
                    </div>
                </div>
                
                <div class="flex justify-end gap-3 mt-6">
                    <button type="button" class="modal-button modal-button-secondary" onclick="closeDeleteConfirmModal()">
                        <div class="flex items-center gap-2">
                            <p>Cancel</p>
                        </div>
                    </button>
                    <button type="button" id="confirmDeleteBtn" class="modal-button bg-red-600 hover:bg-red-700 text-white" onclick="confirmDeletePage()" disabled>
                        <div class="flex items-center gap-2">
                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                            <p>Delete Page</p>
                        </div>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.9.359/pdf.min.js"></script>
    <script>
        // Utility functions (from admin_blogs.html)
        function showModal(title, message, type = 'info') {
            const modal = document.getElementById('messageModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalMessage = document.getElementById('modalMessage');
            const modalContent = modal.querySelector('.modal-content');
            
            modalTitle.textContent = title;
            modalMessage.style.whiteSpace = 'pre-line';
            
            const urlRegex = /(https?:\/\/[^\\s]+)/g;
            if (urlRegex.test(message)) {
                modalMessage.innerHTML = message.replace(urlRegex, '<a href="$1" target="_blank" rel="noopener noreferrer" class="modal-url-link">$1</a>');
            } else {
                modalMessage.textContent = message;
            }
            
            modalContent.classList.remove('error-modal', 'success-modal');
            
            if (type === 'error') {
                modalContent.classList.add('error-modal');
            } else if (type === 'success') {
                modalContent.classList.add('success-modal');
            }
            
            modal.classList.add('show');
            lucide.createIcons();
        }
        
        function closeModal() {
            const modal = document.getElementById('messageModal');
            modal.classList.remove('show');
        }
        
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('messageModal');
            if (event.target === modal) {
                closeModal();
            }
        });
        
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeModal();
                closeDeleteConfirmModal();
            }
        });

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function formatDate(dateString) {
            if (!dateString) return 'No date';
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });
            } catch (e) {
                return dateString;
            }
        }

        // Navbar Tabs (from admin_blogs.html)
        class ExpandableTabs {
            constructor(container, options = {}) {
                this.container = container;
                this.tabs = options.tabs || [];
                this.activeColor = options.activeColor || 'text-blue-600';
                this.onChange = options.onChange || (() => {});
                this.selected = null;
                this.init();
            }
            init() {
                this.render();
                this.bindEvents();
            }
            render() {
                this.container.innerHTML = '';
                this.tabs.forEach((tab, index) => {
                    if (tab.type === 'separator') {
                        const separator = this.createSeparator();
                        this.container.appendChild(separator);
                    } else {
                        const button = this.createTabButton(tab, index);
                        this.container.appendChild(button);
                    }
                });
            }
            createSeparator() {
                const separator = document.createElement('div');
                separator.className = 'separator';
                separator.style.background = 'rgba(255, 255, 255, 0.3)';
                separator.setAttribute('aria-hidden', 'true');
                return separator;
            }
            createTabButton(tab, index) {
                const button = document.createElement('button');
                const isSelected = this.selected === index;
                button.className = `tab-button relative flex items-center text-sm font-medium tracking-wide transition-all duration-[600ms] ${
                    isSelected ? 'selected' : ''
                }`;
                if (isSelected) {
                    button.style.color = this.activeColor || 'rgb(147, 197, 253)';
                } else {
                    button.style.color = 'rgba(255, 255, 255, 0.6)';
                }
                button.dataset.index = index;
                const iconWrapper = document.createElement('div');
                iconWrapper.className = 'flex-shrink-0';
                iconWrapper.innerHTML = `<i data-lucide="${tab.icon}" class="w-4 h-4"></i>`;
                const textElement = document.createElement('span');
                textElement.className = `tab-text ${isSelected ? 'expanded' : ''}`;
                textElement.textContent = tab.title;
                button.appendChild(iconWrapper);
                button.appendChild(textElement);
                button.addEventListener('mouseenter', () => {
                    if (!button.classList.contains('selected')) {
                        button.style.color = 'rgba(255, 255, 255, 0.9)';
                    }
                });
                button.addEventListener('mouseleave', () => {
                    if (!button.classList.contains('selected')) {
                        button.style.color = 'rgba(255, 255, 255, 0.6)';
                    }
                });
                return button;
            }
            handleSelect(index) {
                this.selected = index;
                const buttons = this.container.querySelectorAll('.tab-button');
                buttons.forEach((button, i) => {
                    const buttonIndex = parseInt(button.dataset.index);
                    const textElement = button.querySelector('.tab-text');
                    if (this.selected === buttonIndex) {
                        button.classList.add('selected');
                        button.style.color = this.activeColor || 'rgb(147, 197, 253)';
                        textElement.classList.add('expanded');
                    } else {
                        button.classList.remove('selected');
                        button.style.color = 'rgba(255, 255, 255, 0.6)';
                        textElement.classList.remove('expanded');
                    }
                });
                this.onChange(this.selected);
            }
            bindEvents() {
                if (this.eventsbound) return;
                this.eventsbound = true;
                this.container.addEventListener('click', (e) => {
                    const button = e.target.closest('.tab-button');
                    if (button && button.dataset.index !== undefined) {
                        this.handleSelect(parseInt(button.dataset.index));
                    }
                });
            }
        }
       
        function showContentSection(sectionId) {
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => {
                section.classList.remove('active');
            });
            
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.add('active');
            }
        }

        // File upload and gallery functionality (adapted from admin_blogs.html)
        let imageFilesToUpload = [];
        let magazineFilesToUpload = []; // Keep for magazines, even if not primary focus
        let imageFiles = [];
        let magazineFiles = [];
        
        function setupFileUpload(dropzone, fileInput, fileQueue, uploadBtn, uploadBtnText, filesToUpload, fileType, displayType) {
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropzone.addEventListener(eventName, e => { e.preventDefault(); e.stopPropagation(); });
            });
            
            ['dragenter', 'dragover'].forEach(eventName => {
                dropzone.addEventListener(eventName, () => dropzone.classList.add('dragover'));
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                dropzone.addEventListener(eventName, () => dropzone.classList.remove('dragover'));
            });
            
            dropzone.addEventListener('drop', (e) => handleFiles(e.dataTransfer.files, fileType, filesToUpload, fileQueue, uploadBtn, uploadBtnText));
            fileInput.addEventListener('change', (e) => handleFiles(e.target.files, fileType, filesToUpload, fileQueue, uploadBtn, uploadBtnText));
            
            uploadBtn.addEventListener('click', async () => {
                if (filesToUpload.length === 0) {
                    showToast(`No ${displayType} selected for upload`, 'error');
                    return;
                }
                
                uploadBtn.disabled = true;
                uploadBtnText.textContent = 'Uploading...';
                
                let successCount = 0;
                let errorCount = 0;
                let errorMessages = [];
                
                for (let i = 0; i < filesToUpload.length; i++) {
                    const file = filesToUpload[i];
                    try {
                        const formData = new FormData();
                        formData.append('file', file);
                        
                        const response = await fetch('/upload_file', {
                            method: 'POST',
                            body: formData
                        });
                        
                        const result = await response.json();
                        
                        if (response.ok && result.status === 'success') {
                            successCount++;
                        } else {
                            errorCount++;
                            errorMessages.push(result.message || `Failed to upload ${file.name}`);
                            console.error(`Failed to upload ${file.name}:`, result.message);
                        }
                    } catch (error) {
                        errorCount++;
                        errorMessages.push(`Network error uploading ${file.name}`);
                        console.error(`Network error uploading ${file.name}:`, error);
                    }
                    
                    uploadBtnText.textContent = `Uploading... (${i + 1}/${filesToUpload.length})`;
                }
                
                if (successCount > 0 && errorCount === 0) {
                    showToast(`Successfully uploaded ${successCount} ${displayType.slice(0, -1)}${successCount !== 1 ? 's' : ''}!`, 'success');
                } else if (successCount > 0 && errorCount > 0) {
                    showToast(`Uploaded ${successCount} ${displayType} successfully, but ${errorCount} failed: ${errorMessages.join(', ')}`, 'warning');
                } else {
                    showToast(`All uploads failed: ${errorMessages.join(', ')}`, 'error');
                }
                
                if (successCount > 0) {
                    if (fileType === 'image') {
                        await loadGallery();
                    } else if (fileType === 'pdf') {
                        await loadMagazines();
                    }
                }
                
                filesToUpload.length = 0;
                updateFileQueueUI(filesToUpload, fileQueue, uploadBtn, uploadBtnText);
            });
            
            fileQueue.addEventListener('click', (e) => {
                const removeBtn = e.target.closest('.remove-file-btn');
                if (removeBtn) {
                    filesToUpload.splice(parseInt(removeBtn.dataset.index), 1);
                    updateFileQueueUI(filesToUpload, fileQueue, uploadBtn, uploadBtnText);
                }
            });
        }
        
        function handleFiles(files, fileType, filesToUpload, fileQueue, uploadBtn, uploadBtnText) {
            const validFiles = [];
            const invalidFiles = [];
            
            Array.from(files).forEach(file => {
                if (fileType === 'image') {
                    if (file.type.startsWith('image/') &&
                        ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp', 'image/bmp', 'image/svg+xml'].includes(file.type.toLowerCase())) {
                        validFiles.push(file);
                    } else {
                        invalidFiles.push(file);
                    }
                } else if (fileType === 'pdf') {
                    if (file.name.toLowerCase().endsWith('.pdf') &&
                        (file.type === 'application/pdf' || file.type === '')) {
                        validFiles.push(file);
                    } else {
                        invalidFiles.push(file);
                    }
                }
            });
            
            if (invalidFiles.length > 0) {
                const fileNames = invalidFiles.map(f => f.name).join(', ');
                const expectedTypes = fileType === 'image' ? 'PNG, JPG, JPEG, GIF, WEBP, BMP, SVG' : 'PDF';
                showToast(`Invalid file type(s): ${fileNames}. Expected: ${expectedTypes}`, 'error');
            }
            
            if (validFiles.length > 0) {
                filesToUpload.push(...validFiles);
                updateFileQueueUI(filesToUpload, fileQueue, uploadBtn, uploadBtnText);
            }
        }
        
        function updateFileQueueUI(filesToUpload, fileQueue, uploadBtn, uploadBtnText) {
            fileQueue.innerHTML = '';
            if (filesToUpload.length > 0) {
                filesToUpload.forEach((file, index) => {
                    const fileItem = document.createElement('div');
                    fileItem.className = 'file-queue-item';
                    const iconName = file.type.startsWith('image/') ? 'image' : 'file-text';
                    fileItem.innerHTML = `
                        <div class="flex-shrink-0 mr-3">
                            <i data-lucide="${iconName}" class="w-5 h-5 text-white/70"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="text-sm font-medium truncate">${file.name}</p>
                            <p class="text-xs text-white/50">${(file.size / 1024 / 1024).toFixed(2)} MB</p>
                        </div>
                        <button data-index="${index}" class="remove-file-btn ml-4 text-white/50 hover:text-red-500 transition-colors p-1">
                            <i data-lucide="x" class="w-5 h-5"></i>
                        </button>
                    `;
                    fileQueue.appendChild(fileItem);
                });
                lucide.createIcons();
            }
            uploadBtn.disabled = filesToUpload.length === 0;
            uploadBtnText.textContent = `Upload ${filesToUpload.length} File${filesToUpload.length !== 1 ? 's' : ''}`;
        }
        
        // Gallery functionality
        async function loadGallery() {
            try {
                const response = await fetch('/get_file_details?bucket_name=blog-images'); // Assuming a bucket for general images
                const result = await response.json();
                
                if (result.status === 'success' && result.data) {
                    imageFiles = result.data.map(file => ({
                        id: file.id,
                        name: file.name,
                        url: file.public_url,
                        size: file.size
                    }));
                    renderGallery();
                }
            } catch (error) {
                console.error('Error loading gallery:', error);
            }
        }
        
        async function loadMagazines() {
            try {
                const response = await fetch('/get_file_details?bucket_name=magazine-pdfs');
                const result = await response.json();
                
                if (result.status === 'success' && result.data) {
                    magazineFiles = result.data
                        .filter(file => file.name.toLowerCase().endsWith('.pdf'))
                        .map(file => ({
                            id: file.id,
                            name: file.name,
                            url: file.public_url,
                            size: file.size
                        }));
                    renderMagazines();
                }
            } catch (error) {
                console.error('Error loading magazines:', error);
            }
        }
        
        function renderGallery(searchTerm = '') {
            const galleryGrid = document.getElementById('galleryGrid');
            const noItemsDiv = document.getElementById('noGalleryItems');
            
            if (!galleryGrid) return;
            
            let filteredImages = imageFiles;
            if (searchTerm) {
                filteredImages = imageFiles.filter(item =>
                    item.name.toLowerCase().includes(searchTerm.toLowerCase())
                );
            }
            
            galleryGrid.innerHTML = '';
            
            if (filteredImages.length === 0) {
                noItemsDiv.classList.remove('hidden');
            } else {
                noItemsDiv.classList.add('hidden');
                filteredImages.forEach(item => {
                    const itemEl = document.createElement('div');
                    itemEl.className = 'gallery-item group aspect-square';
                    itemEl.innerHTML = `
                        <img src="${item.url}" alt="${item.name}" class="absolute inset-0 w-full h-full object-cover" loading="lazy">
                        <div class="overlay"></div>
                        <div class="relative z-10 text-white p-2 flex flex-col justify-end h-full opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                            <p class="text-xs font-semibold truncate">${item.name}</p>
                        </div>
                        <div class="actions">
                            <button class="action-btn" data-action="copy" data-url="${item.url}" title="Copy URL">
                                <i data-lucide="link" class="w-3 h-3 text-white"></i>
                            </button>
                            <button class="action-btn" data-action="view" data-url="${item.url}" title="View">
                                <i data-lucide="external-link" class="w-3 h-3 text-white"></i>
                            </button>
                            <button class="action-btn delete" data-action="delete" data-id="${item.id}" data-name="${item.name}" title="Delete">
                                <i data-lucide="trash-2" class="w-3 h-3 text-white"></i>
                            </button>
                        </div>
                    `;
                    galleryGrid.appendChild(itemEl);
                });
            }
            lucide.createIcons();
        }
        
        function renderMagazines(searchTerm = '') {
            const magazinesGrid = document.getElementById('magazinesGrid');
            const noItemsDiv = document.getElementById('noMagazineItems');
            
            if (!magazinesGrid) return;
            
            let filteredMagazines = magazineFiles;
            if (searchTerm) {
                filteredMagazines = magazineFiles.filter(item =>
                    item.name.toLowerCase().includes(searchTerm.toLowerCase())
                );
            }
            
            magazinesGrid.innerHTML = '';
            
            if (filteredMagazines.length === 0) {
                noItemsDiv.classList.remove('hidden');
            } else {
                noItemsDiv.classList.add('hidden');
                filteredMagazines.forEach(item => {
                    const itemEl = document.createElement('div');
                    itemEl.className = 'gallery-item group aspect-[3/4]';
                    itemEl.innerHTML = `
                        <div class="absolute inset-0 w-full h-full bg-white/5 border border-white/20 rounded-lg flex flex-col items-center justify-center">
                            <i data-lucide="file-text" class="w-12 h-12 text-white/60 mb-2"></i>
                            <p class="text-xs text-white/80 text-center px-2">${item.name}</p>
                            <p class="text-xs text-white/50 mt-1">${(item.size / 1024 / 1024).toFixed(2)} MB</p>
                        </div>
                        <div class="overlay"></div>
                        <div class="actions">
                            <button class="action-btn" data-action="copy" data-url="${item.url}" title="Copy URL">
                                <i data-lucide="link" class="w-3 h-3 text-white"></i>
                            </button>
                            <button class="action-btn" data-action="view" data-url="${item.url}" title="View">
                                <i data-lucide="external-link" class="w-3 h-3 text-white"></i>
                            </button>
                            <button class="action-btn delete" data-action="delete" data-id="${item.id}" data-name="${item.name}" title="Delete">
                                <i data-lucide="trash-2" class="w-3 h-3 text-white"></i>
                            </button>
                        </div>
                    `;
                    magazinesGrid.appendChild(itemEl);
                });
            }
            lucide.createIcons();
        }
        
        // Gallery actions
        const galleryGrid = document.getElementById('galleryGrid');
        const magazinesGrid = document.getElementById('magazinesGrid');
        
        if (galleryGrid) {
            galleryGrid.addEventListener('click', (e) => {
                const actionBtn = e.target.closest('.action-btn');
                if (!actionBtn) return;
                
                const action = actionBtn.dataset.action;
                const itemUrl = actionBtn.dataset.url;
                const itemId = actionBtn.dataset.id;
                const itemName = actionBtn.dataset.name;
                
                if (action === 'copy') {
                    if (navigator.clipboard && window.isSecureContext) {
                        navigator.clipboard.writeText(itemUrl).then(() => {
                            showToast('URL copied to clipboard!', 'success');
                        }).catch(() => {
                            fallbackCopyTextToClipboard(itemUrl);
                        });
                    } else {
                        fallbackCopyTextToClipboard(itemUrl);
                    }
                } else if (action === 'view') {
                    window.open(itemUrl, '_blank');
                } else if (action === 'delete') {
                    handleGalleryDelete(itemId, itemName, 'image');
                }
            });
        }
        
        if (magazinesGrid) {
            magazinesGrid.addEventListener('click', (e) => {
                const actionBtn = e.target.closest('.action-btn');
                if (!actionBtn) return;
                
                const action = actionBtn.dataset.action;
                const itemUrl = actionBtn.dataset.url;
                const itemId = actionBtn.dataset.id;
                const itemName = actionBtn.dataset.name;
                
                if (action === 'copy') {
                    if (navigator.clipboard && window.isSecureContext) {
                        navigator.clipboard.writeText(itemUrl).then(() => {
                            showToast('URL copied to clipboard!', 'success');
                        }).catch(() => {
                            fallbackCopyTextToClipboard(itemUrl);
                        });
                    } else {
                        fallbackCopyTextToClipboard(itemUrl);
                    }
                } else if (action === 'view') {
                    window.open(itemUrl, '_blank');
                } else if (action === 'delete') {
                    handleGalleryDelete(itemId, itemName, 'magazine');
                }
            });
        }
        
        // Search functionality
        const gallerySearchInput = document.getElementById('gallerySearchInput');
        const magazinesSearchInput = document.getElementById('magazinesSearchInput');
        
        if (gallerySearchInput) {
            const gallerySearchContainer = gallerySearchInput.parentElement;
            
            gallerySearchInput.addEventListener('focus', () => {
                gallerySearchContainer.classList.add('focused');
            });
            
            gallerySearchInput.addEventListener('blur', () => {
                gallerySearchContainer.classList.remove('focused');
            });
            
            gallerySearchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.trim();
                renderGallery(searchTerm);
            });
        }
        
        if (magazinesSearchInput) {
            const magazinesSearchContainer = magazinesSearchInput.parentElement;
            
            magazinesSearchInput.addEventListener('focus', () => {
                magazinesSearchContainer.classList.add('focused');
            });
            
            magazinesSearchInput.addEventListener('blur', () => {
                magazinesSearchContainer.classList.remove('focused');
            });
            
            magazinesSearchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.trim();
                renderMagazines(searchTerm);
            });
        }
        
        function fallbackCopyTextToClipboard(text) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "fixed";
            textArea.style.top = "0";
            textArea.style.left = "0";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            try {
                document.execCommand('copy');
                showToast('URL copied to clipboard!', 'success');
            } catch (err) {
                console.error('Failed to copy', err);
                showToast('Failed to copy URL', 'error');
            }
            document.body.removeChild(textArea);
        }
        
        // Toast notification function
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            let bgColor = 'bg-green-600';
            if (type === 'error') {
                bgColor = 'bg-red-600';
            } else if (type === 'warning') {
                bgColor = 'bg-yellow-600';
            }
            toast.className = `fixed top-4 right-4 ${bgColor} text-white px-4 py-2 rounded-lg shadow-lg z-50 transition-all duration-300`;
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateY(-20px)';
                setTimeout(() => {
                    if (toast.parentElement) {
                        document.body.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }
        
        // Delete function for gallery and magazines
        async function handleGalleryDelete(itemId, itemName, type) {
            if (!itemName) {
                console.error('No file name provided to handleGalleryDelete');
                showToast('Error: File name is missing', 'error');
                return;
            }
            
            const displayType = type === 'image' ? 'image' : 'magazine';
            
            if (confirm(`Are you sure you want to delete "${itemName}"? This action cannot be undone.`)) {
                showToast('Deleting file...', 'success');
                
                try {
                    const response = await fetch('/delete_file', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            file_name: itemName
                        })
                    });
                    
                    const result = await response.json();
                    
                    if (response.ok && result.status === 'success') {
                        if (type === 'image') {
                            const itemIndex = imageFiles.findIndex(item => item.id == itemId);
                            if (itemIndex > -1) {
                                imageFiles.splice(itemIndex, 1);
                                renderGallery();
                            } else {
                                await loadGallery();
                            }
                        } else {
                            const itemIndex = magazineFiles.findIndex(item => item.id == itemId);
                            if (itemIndex > -1) {
                                magazineFiles.splice(itemIndex, 1);
                                renderMagazines();
                            } else {
                                await loadMagazines();
                            }
                        }
                        showToast(`${displayType.charAt(0).toUpperCase() + displayType.slice(1)} "${itemName}" deleted successfully!`, 'success');
                    } else {
                        console.error('Delete failed:', result.message);
                        showToast(`Failed to delete ${displayType}: ${result.message || 'Unknown error'}`, 'error');
                    }
                } catch (error) {
                    console.error('Error deleting file:', error);
                    showToast(`Error deleting ${displayType}: ${error.message}`, 'error');
                }
            }
        }

        // Page management variables
        let currentPage = 1;
        let totalPages = 1;
        const pagesPerPage = 8;
        let allFetchedPages = [];
        let currentEditingPage = null;

        async function fetchPages() {
            const pagesLoading = document.getElementById('pagesLoading');
            const noPagesFound = document.getElementById('noPagesFound');
            const pagesList = document.getElementById('pagesList');
            const paginationControls = document.getElementById('paginationControls');
        
            pagesLoading.classList.remove('hidden');
            noPagesFound.classList.add('hidden');
            pagesList.innerHTML = '';
            paginationControls.classList.add('hidden');
        
            try {
                const response = await fetch('/get_main_pages'); // Assuming an endpoint to fetch main_pages
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const result = await response.json();
                pagesLoading.classList.add('hidden');
                if (result.status === 'success' && result.pages) {
                    allFetchedPages = result.pages;
                    applyFiltersAndRenderPages(1);
                } else {
                    allFetchedPages = [];
                    applyFiltersAndRenderPages(1);
                }
            } catch (error) {
                console.error('Error fetching pages:', error);
                pagesLoading.classList.add('hidden');
                pagesList.innerHTML = `<div class="text-center py-8"><p class="text-white/60">Error loading pages. Please try again later.</p></div>`;
            }
        }

        function applyFiltersAndRenderPages(page = 1) {
            const filterPageNameValue = document.getElementById('filterPageName').value.trim().toLowerCase();
        
            const filteredPages = allFetchedPages.filter(pageItem => {
                const pageName = (pageItem.page_name || '').toLowerCase();
                const pageStatus = (pageItem.page_data && pageItem.page_data.status) ? pageItem.page_data.status.toLowerCase() : 'published'; // Default to published if status is not set
                
                const matchesName = !filterPageNameValue || pageName.includes(filterPageNameValue);
                // Exclude pages with 'DELETED' status
                const isVisibleStatus = pageStatus !== 'deleted';

                return matchesName && isVisibleStatus;
            });
        
            const noPagesFound = document.getElementById('noPagesFound');
            const pagesList = document.getElementById('pagesList');
            const paginationControls = document.getElementById('paginationControls');
        
            if (filteredPages.length > 0) {
                noPagesFound.classList.add('hidden');
                pagesList.classList.remove('hidden');
                
                totalPages = Math.ceil(filteredPages.length / pagesPerPage);
                currentPage = page;
                const startIndex = (page - 1) * pagesPerPage;
                const endIndex = startIndex + pagesPerPage;
                const paginatedPages = filteredPages.slice(startIndex, endIndex);
                
                displayPages(paginatedPages);
                
                if (totalPages > 1) {
                    updatePaginationControls();
                    paginationControls.classList.remove('hidden');
                } else {
                    paginationControls.classList.add('hidden');
                }
            } else {
                pagesList.innerHTML = '';
                pagesList.classList.add('hidden');
                noPagesFound.classList.remove('hidden');
                paginationControls.classList.add('hidden');
            }
        }
        
        // Display pages function
        function displayPages(pages) {
            const pagesList = document.getElementById('pagesList');
            
            pagesList.innerHTML = pages.map(page => {
                const pageName = page.page_name || 'Untitled Page';
                const updatedAt = page.updated_at || '';
                
                return `
                    <div class="p-4 bg-white/5 rounded-lg border border-white/10 hover:bg-white/10 transition-colors">
                        <div class="flex justify-between items-start mb-3">
                            <div class="flex-1">
                                <h3 class="font-semibold mb-2 text-white line-clamp-2">${escapeHtml(pageName)}</h3>
                                <p class="text-sm text-white/60 mb-2 flex items-center gap-2 flex-wrap">
                                    <span class="flex items-center gap-1">
                                        <i data-lucide="calendar" class="w-3 h-3"></i>
                                        <span>Last Updated: ${formatDate(updatedAt)}</span>
                                    </span>
                                </p>
                            </div>
                        </div>
                        <div class="flex gap-2 flex-wrap">
                            <button class="form-button text-xs px-4 py-2 min-w-[70px] bg-white/10 hover:bg-white/20 border border-white/20 text-white" onclick="editPage('${page.page_id.replace(/'/g,"[quotetation_here]")}')">
                                <div class="flex items-center gap-2">
                                    <i data-lucide="edit" class="w-3 h-3"></i>
                                    <p>Edit</p>
                                </div>
                            </button>
                            <button class="form-button text-xs px-4 py-2 min-w-[70px] bg-blue-600 hover:bg-blue-700 text-white" onclick="window.open('/${page.href.replace(/'/g,"[quotetation_here]")}', '_blank')">
                                <div class="flex items-center gap-2">
                                    <i data-lucide="eye" class="w-3 h-3"></i>
                                    <p>View Page</p>
                                </div>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
            
            lucide.createIcons();
        }
        
        // Update pagination controls
        function updatePaginationControls() {
            const prevBtn = document.getElementById('prevPage');
            const nextBtn = document.getElementById('nextPage');
            const pageInfo = document.getElementById('pageInfo');
            
            if (prevBtn) {
                prevBtn.disabled = currentPage <= 1;
            }
            if (nextBtn) {
                nextBtn.disabled = currentPage >= totalPages;
            }
            if (pageInfo) {
                pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
            }
        }

        async function editPage(pageId) {
            pageId = pageId.replace("[quotetation_here]", "'");
            if (!pageId) {
                showModal('Error', 'Page ID not found', 'error');
                return;
            }
            
            const page = allFetchedPages.find(p => p.page_id === pageId);
            if (page) {
                currentEditingPage = page;
                populatePageEditorForm(page);
                showContentSection('pageEditorSection');
            } else {
                showModal('Error', 'Page not found in the list. Please refresh.', 'error');
            }
        }

        function populatePageEditorForm(page, dataToPopulate = null) {
            document.getElementById('pageId').value = page.page_id;
            document.getElementById('pageName').value = page.page_name;
            document.getElementById('pageUpdatedAt').value = page.updated_at;
            document.getElementById('editingPageName').textContent = page.page_name;

            const jsonEditor = document.getElementById('jsonEditor');
            jsonEditor.innerHTML = ''; // Clear previous fields

            const data = dataToPopulate || page.page_data;

            // Recursively create form fields for JSON data
            function createFormFields(data, containerElement, prefix = '') {
                for (const key in data) {
                    const value = data[key];
                    const currentPrefix = prefix ? `${prefix}.${key}` : key;
                    const fieldId = `input_${currentPrefix.replace(/[^a-zA-Z0-9_]/g, '_')}`; // Sanitize key for ID

                    const labelText = key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase());

                    if (typeof value === 'object' && value !== null && !Array.isArray(value)) {
                        // Nested object
                        const sectionWrapper = document.createElement('div');
                        sectionWrapper.className = 'p-3 rounded-lg bg-transparent border-transparent mb-3';
                        sectionWrapper.innerHTML = `<h4 class="text-sm font-medium text-white/80 mb-3 flex items-center"><i data-lucide="folder" class="w-4 h-4 mr-2"></i>${labelText}</h4>`;
                        const innerContainer = document.createElement('div'); // This will hold the nested fields
                        sectionWrapper.appendChild(innerContainer);
                        containerElement.appendChild(sectionWrapper); // Append the section wrapper to the current container
                        createFormFields(value, innerContainer, currentPrefix); // Recurse for nested objects, passing innerContainer
                    } else if (Array.isArray(value)) {
                        // Array
                        const arrayWrapper = document.createElement('div');
                        arrayWrapper.className = 'p-3 rounded-lg bg-transparent border-transparent mb-3';
                        arrayWrapper.innerHTML = `
                            <h4 class="text-sm font-medium text-white/80 mb-3 flex items-center">
                                <i data-lucide="list" class="w-4 h-4 mr-2"></i>${labelText}
                            </h4>
                            <div class="array-items-container space-y-4" data-array-key="${currentPrefix}"></div>
                        `;
                        const arrayItemsContainer = arrayWrapper.querySelector('.array-items-container');
                        containerElement.appendChild(arrayWrapper);

                        if (value.length > 0 && typeof value[0] === 'object' && value[0] !== null) {
                            // Array of objects
                            value.forEach((item, index) => {
                                const itemContainer = document.createElement('div');
                                itemContainer.className = 'p-3 rounded-lg bg-transparent border-transparent relative group';
                                itemContainer.innerHTML = `
                                    <h5 class="text-sm font-medium text-white/90 mb-3 flex items-center">
                                        <i data-lucide="package" class="w-4 h-4 mr-2"></i>${labelText} Item ${index + 1}
                                    </h5>
                                    <div class="item-fields-container"></div>
                                `;
                                const itemFieldsContainer = itemContainer.querySelector('.item-fields-container');
                                arrayItemsContainer.appendChild(itemContainer);
                                createFormFields(item, itemFieldsContainer, `${currentPrefix}[${index}]`); // Recurse for array items
                            });
                        } else {
                            // Array of primitives (strings, numbers, booleans) or empty array
                            // Use a single textarea for the entire primitive array
                            const formItem = document.createElement('div');
                            formItem.className = 'form-item';
                            formItem.innerHTML = `
                                <label class="form-label" for="${fieldId}">${labelText} (JSON Array)</label>
                                <textarea id="${fieldId}" name="${currentPrefix}" class="form-input" style="height: 4rem; resize: vertical;" placeholder="Enter JSON array content (e.g., ["item1", "item2"])...">${JSON.stringify(value, null, 2)}</textarea>
                            `;
                            arrayItemsContainer.appendChild(formItem);
                        }
                    } else {
                        // Primitive type (string, number, boolean)
                        const formItem = document.createElement('div');
                        formItem.className = 'form-item';
                        let inputElement;
                        if (typeof value === 'boolean') {
                            inputElement = `<div class="flex items-center mt-2"><input type="checkbox" id="${fieldId}" name="${currentPrefix}" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500" ${value ? 'checked' : ''}><label for="${fieldId}" class="ml-2 text-sm text-white/80">${labelText}</label></div>`;
                            formItem.innerHTML = inputElement; // Checkbox label is integrated
                        } else if (typeof value === 'number') {
                            inputElement = `<input type="number" id="${fieldId}" name="${currentPrefix}" class="form-input" value="${value}">`;
                            formItem.innerHTML = `<label class="form-label" for="${fieldId}">${labelText}</label>${inputElement}`;
                        } else {
                            inputElement = `<input type="text" id="${fieldId}" name="${currentPrefix}" class="form-input" value="${escapeHtml(String(value))}">`;
                            formItem.innerHTML = `<label class="form-label" for="${fieldId}">${labelText}</label>${inputElement}`;
                        }
                        containerElement.appendChild(formItem);
                    }
                }
            }
            createFormFields(data, jsonEditor);
            lucide.createIcons();
            setupDynamicFormListeners(); // Call this after creating form fields
        }

        function collectPageDataFromForm() {
            const pageData = {};
            const form = document.getElementById('pageEditorForm');
            const inputs = form.querySelectorAll('#jsonEditor input, #jsonEditor textarea');

            inputs.forEach(input => {
                const nameAttribute = input.name;
                if (!nameAttribute) return; // Skip elements without a name

                // Parse name attribute to handle nested objects and arrays (e.g., "parent.array_name[0].field")
                const parts = nameAttribute.split('.');
                let currentLevel = pageData;

                parts.forEach((part, index) => {
                    // Check for array notation (e.g., "array_name[0]")
                    const arrayMatch = part.match(/^(.*)\[(\d+)\]$/);
                    if (arrayMatch) {
                        const arrayName = arrayMatch[1];
                        const arrayIndex = parseInt(arrayMatch[2], 10);

                        if (!currentLevel[arrayName]) {
                            currentLevel[arrayName] = [];
                        }
                        // Ensure the array has enough elements
                        while (currentLevel[arrayName].length <= arrayIndex) {
                            currentLevel[arrayName].push({});
                        }
                        currentLevel = currentLevel[arrayName][arrayIndex];
                    } else {
                        // Regular object key
                        if (index === parts.length - 1) {
                            // Last part, assign the value
                            if (input.type === 'checkbox') {
                                currentLevel[part] = input.checked;
                            } else if (input.type === 'number') {
                                currentLevel[part] = parseFloat(input.value);
                                if (isNaN(currentLevel[part])) {
                                    currentLevel[part] = null; // Or handle error appropriately
                                }
                            } else if (input.tagName === 'TEXTAREA') {
                                try {
                                    currentLevel[part] = JSON.parse(input.value);
                                } catch (e) {
                                    currentLevel[part] = input.value; // Fallback to string if not valid JSON
                                }
                            } else {
                                currentLevel[part] = input.value;
                            }
                        } else {
                            // Intermediate object, create if it doesn't exist
                            if (!currentLevel[part]) {
                                currentLevel[part] = {};
                            }
                            currentLevel = currentLevel[part];
                        }
                    }
                });
            });
            return pageData;
        }

        function setupDynamicFormListeners() {
            // Add Item button listener
            document.querySelectorAll('.add-array-item-btn').forEach(button => {
                button.onclick = (event) => {
                    const arrayKey = event.currentTarget.dataset.arrayKey;
                    const parts = arrayKey.split('.');
                    let currentData = currentEditingPage.page_data;
                    for (const part of parts) {
                        const arrayMatch = part.match(/^(.*)\[(\d+)\]$/);
                        if (arrayMatch) {
                            currentData = currentData[arrayMatch[1]][parseInt(arrayMatch[2], 10)];
                        } else {
                            currentData = currentData[part];
                        }
                    }

                    // Determine the default structure for a new item
                    let newItem = {};
                    if (currentData.length > 0 && typeof currentData[0] === 'object' && currentData[0] !== null) {
                        // If existing items are objects, create a new empty object with same keys,
                        // initialized with default values (empty string, 0, false, empty array/object)
                        for (const prop in currentData[0]) {
                            const sampleValue = currentData[0][prop];
                            if (typeof sampleValue === 'string') newItem[prop] = '';
                            else if (typeof sampleValue === 'number') newItem[prop] = 0;
                            else if (typeof sampleValue === 'boolean') newItem[prop] = false;
                            else if (Array.isArray(sampleValue)) newItem[prop] = [];
                            else if (typeof sampleValue === 'object' && sampleValue !== null) newItem[prop] = {};
                            else newItem[prop] = null; // Fallback for other types
                        }
                    } else {
                        // If array is empty or contains primitives, add a generic empty object.
                        // This assumes the user wants to add an object to the array.
                        // For primitive arrays, this might not be the desired behavior.
                        newItem = {};
                    }

                    currentData.push(newItem);
                    populatePageEditorForm(currentEditingPage, currentEditingPage.page_data); // Re-render form with updated data
                };
            });

            // Remove Item button listener
            document.querySelectorAll('.remove-array-item-btn').forEach(button => {
                button.onclick = (event) => {
                    const arrayKey = event.currentTarget.dataset.arrayKey;
                    const itemIndex = parseInt(event.currentTarget.dataset.itemIndex, 10);

                    const parts = arrayKey.split('.');
                    let currentData = currentEditingPage.page_data;
                    for (const part of parts) {
                        const arrayMatch = part.match(/^(.*)\[(\d+)\]$/);
                        if (arrayMatch) {
                            currentData = currentData[arrayMatch[1]][parseInt(arrayMatch[2], 10)];
                        } else {
                            currentData = currentData[part];
                        }
                    }

                    if (Array.isArray(currentData) && itemIndex >= 0 && itemIndex < currentData.length) {
                        currentData.splice(itemIndex, 1);
                        populatePageEditorForm(currentEditingPage, currentEditingPage.page_data); // Re-render form with updated data
                    }
                };
            });
        }

        async function handleUpdatePage() {
            if (!currentEditingPage) {
                showModal('Error', 'No page selected for editing', 'error');
                return;
            }

            const pageId = document.getElementById('pageId').value;
            const pageName = document.getElementById('pageName').value;
            const pageUpdatedAt = document.getElementById('pageUpdatedAt').value;
            const pageData = collectPageDataFromForm();

            const data = {
                page_id: pageId,
                page_name: pageName,
                updated_at: pageUpdatedAt, // Send back original updated_at, server will update timestamp
                page_data: pageData,
                enc_email: localStorage.getItem('enc_email') || '',
                enc_pwd: localStorage.getItem('enc_pwd') || '',
            };

            try {
                const updatePageBtn = document.getElementById('updatePageBtn');
                const originalText = updatePageBtn.innerHTML;
                updatePageBtn.innerHTML = '<i data-lucide="loader-2" class="w-4 h-4 mr-2 animate-spin"></i>Updating...';
                updatePageBtn.disabled = true;
                
                const response = await fetch('/update_main_page', { // Assuming an endpoint for updating pages
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                updatePageBtn.innerHTML = originalText;
                updatePageBtn.disabled = false;
                
                if (!response.ok) {
                    let errorMessage = `Server error (${response.status})`;
                    try {
                        const errorResult = await response.json();
                        errorMessage = errorResult.message || errorResult.error || errorMessage;
                    } catch (e) {
                        errorMessage = response.statusText || errorMessage;
                    }
                    showModal('Error Updating Page', errorMessage, 'error');
                    return;
                }
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    showModal('Success', 'Page updated successfully!', 'success');
                    // Refresh page list and switch back
                    fetchPages();
                    showContentSection('pageListSection');
                } else {
                    showModal('Error Updating Page', result.message || 'Unknown error', 'error');
                }
                
            } catch (error) {
                const updatePageBtn = document.getElementById('updatePageBtn');
                updatePageBtn.innerHTML = '<i data-lucide="save" class="w-4 h-4 mr-2"></i>Update Page';
                updatePageBtn.disabled = false;
                
                console.error('Error updating page:', error);
                showModal('Error Updating Page', error.message, 'error');
            }
        }

        async function handlePreviewPage() {
            if (!currentEditingPage) {
            showModal('Error', 'No page selected for preview', 'error');
            return;
            }

            const pageId = document.getElementById('pageId').value;
            const pageName = document.getElementById('pageName').value;
            const pageData = collectPageDataFromForm();

            try {
            const previewPageBtn = document.getElementById('previewPageBtn');
            const originalText = previewPageBtn.innerHTML;
            previewPageBtn.innerHTML = '<i data-lucide="loader-2" class="w-4 h-4 mr-2 animate-spin"></i>Loading...';
            previewPageBtn.disabled = true;

            const response = await fetch('/preview_main_page', { // Assuming a preview endpoint
                method: 'POST',
                headers: {
                'Content-Type': 'application/json',
                },
                body: JSON.stringify({ 
                page_id: pageId, 
                page_name: pageName,
                page_data: pageData 
                })
            });

            previewPageBtn.innerHTML = originalText;
            previewPageBtn.disabled = false;

            if (!response.ok) {
                let errorMessage = `Server error (${response.status})`;
                try {
                const errorResult = await response.json();
                errorMessage = errorResult.message || errorResult.error || errorMessage;
                } catch (e) {
                errorMessage = response.statusText || errorMessage;
                }
                showModal('Error Generating Preview', errorMessage, 'error');
                return;
            }

            const result = await response.json();

            if (result.status === 'success' && result.html) {
                const previewWindow = window.open('', '_blank', 'width=800,height=600,scrollbars=yes');
                previewWindow.document.write(result.html);
                previewWindow.document.close();
            } else {
                showModal('Error Generating Preview', result.message || 'Unknown error', 'error');
            }

            } catch (error) {
            const previewPageBtn = document.getElementById('previewPageBtn');
            previewPageBtn.innerHTML = '<i data-lucide="eye" class="w-4 h-4 mr-2"></i>Preview Page';
            previewPageBtn.disabled = false;
            
            console.error('Error previewing page:', error);
            showModal('Error Previewing Page', error.message, 'error');
            }
        }

        // Delete confirmation dialog variables
        let currentDeletePageId = null;
        let currentDeletePageName = '';
        
        function showDeleteConfirmModal(pageId, pageName) {
            currentDeletePageId = pageId;
            currentDeletePageName = pageName;
            
            const deleteModal = document.getElementById('deleteConfirmModal');
            const deletePageNameElement = document.getElementById('deletePageName');
            const confirmCheckbox = document.getElementById('confirmDeleteCheckbox');
            const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
            
            // Set page name
            deletePageNameElement.textContent = pageName;
            
            // Clear previous values
            confirmCheckbox.checked = false;
            confirmDeleteBtn.disabled = true;
            
            // Show modal
            deleteModal.classList.add('show');
            
            // Recreate icons
            lucide.createIcons();
        }
        
        function closeDeleteConfirmModal() {
            const deleteModal = document.getElementById('deleteConfirmModal');
            deleteModal.classList.remove('show');
            
            // Clear variables
            currentDeletePageId = null;
            currentDeletePageName = '';
        }
        
        function updateDeleteButtonState() {
            const confirmCheckbox = document.getElementById('confirmDeleteCheckbox');
            const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
            
            confirmDeleteBtn.disabled = !confirmCheckbox.checked;
        }
        
        async function confirmDeletePage() {
            if (!currentDeletePageId) {
                showModal('Error', 'No page selected for deletion', 'error');
                return;
            }
            
            const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
            
            try {
                // Update button state
                const originalText = confirmDeleteBtn.innerHTML;
                confirmDeleteBtn.innerHTML = '<i data-lucide="loader-2" class="w-4 h-4 mr-2 animate-spin"></i>Deleting...';
                confirmDeleteBtn.disabled = true;
                
                const response = await fetch('/delete_main_page', { // Assuming an endpoint for deleting pages
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        page_id: currentDeletePageId
                    })
                });
                
                // Reset button state
                confirmDeleteBtn.innerHTML = originalText;
                confirmDeleteBtn.disabled = false;
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    showModal('Success', `Page "${currentDeletePageName}" deleted successfully!`, 'success');
                    
                    // Close modal
                    closeDeleteConfirmModal();
                    
                    // Refresh the page list
                    fetchPages();
                } else {
                    showModal('Error', result.message || 'Failed to delete page', 'error');
                }
                
            } catch (error) {
                console.error('Error deleting page:', error);
                
                // Reset button state
                confirmDeleteBtn.innerHTML = '<i data-lucide="trash-2" class="w-4 h-4 mr-2"></i>Delete Page';
                confirmDeleteBtn.disabled = false;
                
                showModal('Error', 'An error occurred while deleting the page. Please try again.', 'error');
            }
        }

        function deletePage(pageId, pageName) {
            pageId = pageId.replace("[quotetation_here]", "'");
            pageName = pageName.replace("[quotetation_here]", "'");
            if (!pageId) {
                showModal('Error', 'Page ID not found', 'error');
                return;
            }
            
            // Show the delete confirmation modal
            showDeleteConfirmModal(pageId, pageName);
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            lucide.createIcons();
            
            // Initialize image upload functionality
            const imageDropzone = document.getElementById('imageDropzone');
            const imageFileInput = document.getElementById('imageFileInput');
            const imageFileQueue = document.getElementById('imageFileQueue');
            const imageUploadBtn = document.getElementById('imageUploadBtn');
            const imageUploadBtnText = document.getElementById('imageUploadBtnText');
            
            if (imageDropzone && imageFileInput) {
                setupFileUpload(
                    imageDropzone, imageFileInput, imageFileQueue, imageUploadBtn, imageUploadBtnText,
                    imageFilesToUpload, 'image', 'images'
                );
            }

            // Initialize magazine upload functionality (if needed)
            const magazineDropzone = document.getElementById('magazineDropzone');
            const magazineFileInput = document.getElementById('magazineFileInput');
            const magazineFileQueue = document.getElementById('magazineFileQueue');
            const magazineUploadBtn = document.getElementById('magazineUploadBtn');
            const magazineUploadBtnText = document.getElementById('magazineUploadBtnText');
            
            if (magazineDropzone && magazineFileInput) {
                setupFileUpload(
                    magazineDropzone, magazineFileInput, magazineFileQueue, magazineUploadBtn, magazineUploadBtnText,
                    magazineFilesToUpload, 'pdf', 'magazines'
                );
            }
            
            // Left sidebar tab functionality
            const leftTabButtons = document.querySelectorAll('.left-tab-button');
            const leftContentSections = document.querySelectorAll('.left-content-section');
            
            leftTabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-left-tab');
                    
                    // Remove active class from all buttons
                    leftTabButtons.forEach(btn => btn.classList.remove('active'));
                    // Add active class to clicked button
                    this.classList.add('active');
                    
                    // Hide all content sections
                    leftContentSections.forEach(section => section.classList.remove('active'));
                    // Show corresponding content section
                    const targetSection = document.getElementById(tabName + 'Content');
                    if (targetSection) {
                        targetSection.classList.add('active');
                    }
                    
                    // Load content when needed
                    if (tabName === 'storage') {
                        setTimeout(() => {
                            loadGallery();
                            loadMagazines();
                        }, 100);
                    }
                });
            });
            
            // Storage sub-tabs functionality
            const storageSubTabs = document.querySelectorAll('.storage-sub-tab');
            const storageSubContents = document.querySelectorAll('.storage-sub-content');
            
            storageSubTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const subTabName = this.getAttribute('data-storage-tab');
                    
                    // Remove active class from all sub-tabs
                    storageSubTabs.forEach(subTab => {
                        subTab.classList.remove('active');
                        subTab.style.background = 'rgba(255, 255, 255, 0.05)';
                        subTab.style.color = 'rgba(255, 255, 255, 0.6)';
                        subTab.style.borderColor = 'rgba(255, 255, 255, 0.1)';
                    });
                    
                    // Add active class to clicked sub-tab
                    this.classList.add('active');
                    this.style.background = 'rgba(59, 130, 246, 0.2)';
                    this.style.color = 'white';
                    this.style.borderColor = 'rgba(59, 130, 246, 0.4)';
                    
                    // Hide all sub-content sections
                    storageSubContents.forEach(content => content.classList.remove('active'));
                    
                    // Show corresponding sub-content
                    const targetSubContent = document.getElementById(subTabName + 'SubContent');
                    if (targetSubContent) {
                        targetSubContent.classList.add('active');
                    }
                    
                    // Load content when needed
                    if (subTabName === 'gallery') {
                        setTimeout(() => loadGallery(), 100);
                    } else if (subTabName === 'magazines') {
                        setTimeout(() => loadMagazines(), 100);
                    }
                });
            });

            // Page List Filter functionality
            const filterPageNameInput = document.getElementById('filterPageName');
 
            function setupPageFilterListeners() {
                const applyFilters = () => applyFiltersAndRenderPages(1);
                const debounce = (func, delay) => {
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(func, delay);
                };
                filterPageNameInput.addEventListener('input', () => debounce(applyFilters, 300));
            }
            setupPageFilterListeners();

            // Pagination event listeners for Page List
            const prevPage = document.getElementById('prevPage');
            const nextPage = document.getElementById('nextPage');
            
            if (prevPage) {
                prevPage.addEventListener('click', () => {
                    if (currentPage > 1) {
                        applyFiltersAndRenderPages(currentPage - 1);
                    }
                });
            }
            
            if (nextPage) {
                nextPage.addEventListener('click', () => {
                    if (currentPage < totalPages) {
                        applyFiltersAndRenderPages(currentPage + 1);
                    }
                });
            }

            // Edit Page buttons
            document.getElementById('cancelEditBtn').addEventListener('click', () => {
                showContentSection('pageListSection');
                fetchPages(); // Refresh the list after cancelling edit
            });
            document.getElementById('updatePageBtn').addEventListener('click', handleUpdatePage);
            document.getElementById('previewPageBtn').addEventListener('click', handlePreviewPage);

            // Delete confirmation checkbox listener
            document.getElementById('confirmDeleteCheckbox').addEventListener('change', updateDeleteButtonState);

            // Initial load of pages
            fetchPages();

            // Navbar tabs (simplified for page updater)
            const navbarTabs = [
                { title: "Homepage", icon: "home" },
                { title: "Manage Pages", icon: "file-text" },
            ];
            const navbarContainer = document.getElementById('navbarTabs');
            const expandableTabs = new ExpandableTabs(navbarContainer, {
                tabs: navbarTabs,
                activeColor: 'text-blue-400',
                onChange: (index) => {
                    if (index !== null && navbarTabs[index]) {
                        if (navbarTabs[index].title === "Homepage") {
                            window.location.href = '/admin_login'; // Redirect to admin homepage
                        } else if (navbarTabs[index].title === "Manage Pages") {
                            showContentSection('pageListSection');
                            fetchPages(); // Load pages when this tab is selected
                        }
                    }
                }
            });
            expandableTabs.selected = 1; // Select "Manage Pages" by default
            expandableTabs.render();
        });
    </script>
</body>
</html>